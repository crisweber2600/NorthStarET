<div ng-controller="SectionDataEntryController">
    <div id="page-heading">
        <ol class="breadcrumb">
            <li>Data Entry</li>
            <li class="active">Edit Assessment Data</li>
        </ol>
        <h1>Edit Assessment Results for {{assessment.AssessmentName}}</h1>
        <div class="options">
            <div class="btn-toolbar">
                <a ng-if="assessment.CanImport" ng-click="getTemplate()" class="btn btn-primary hidden-xs"><i class="fa fa-download"></i> Download Export Template</a>
                <a ng-if="assessment.CanImport" ng-click="openImportDialog()" class="btn btn-success hidden-xs"><i class="fa fa-upload"></i> Import Data</a>
                
                <print-button print-landscape="true" sort-array="sortArray" print-multi-page="false" fit-viewer-height="" fit-width="" html-viewer-height="1450" html-viewer-width="2000" stretch-to-fit=""></print-button>
            </div>
        </div>
    </div>
    <div class="col-md-12 ng-scope" id="mainfilter">
        <ns-filter-options-container-directive benchmark-date-enabled="false" school-year-enabled="true" school-enabled="true" grade-enabled="true" teacher-enabled="true" section-enabled="true" ></ns-filter-options-container-directive>
    </div>
    <div class="col-md-12">
        <ns-error-display></ns-error-display>
        <div class="col-md-12">
            <uib-alert ng-show="uploadSettings.uploadComplete" type="success"><b>Note:</b> If there were any issues while uploading your data, you can view them by downloading the <a class="btn btn-success" ng-click="downloadResult()"> Log File <i class="fa fa-download"></i></a></uib-alert>
        </div>
    </div>

    <div class="col-md-12" ng-if="filterOptions.selectedSection != null">
        <standard-report-header heading="assessment.AssessmentName  + ' Data Entry'" options="filterOptions"></standard-report-header>
    </div> 

    <div style="min-height:350px;">
        <spinner name="tableSpinner">
            <div class="hidden-print" style="position:absolute;width:100%;height:100%;background-color:rgba(100, 100, 100, 0.7);z-index:100;">
                <div class="sk-cube-grid">
                    <div class="sk-cube sk-cube1"></div>
                    <div class="sk-cube sk-cube2"></div>
                    <div class="sk-cube sk-cube3"></div>
                    <div class="sk-cube sk-cube4"></div>
                    <div class="sk-cube sk-cube5"></div>
                    <div class="sk-cube sk-cube6"></div>
                    <div class="sk-cube sk-cube7"></div>
                    <div class="sk-cube sk-cube8"></div>
                    <div class="sk-cube sk-cube9"></div>
                </div>
            </div>
        </spinner>
        <div class="col-md-12 table-vertical">
            <uib-tabset tab-theme="orange">
                <uib-tab ng-repeat="tdd in filterOptions.benchmarkDates" active="tdd.active" ng-click="navigateToTdd(tdd.id)">
                    <uib-tab-heading>
                        <div class="row col"><div class="col-md-2"><div style="border:1px solid black;width:20px;height:20px;background-color:{{tdd.Hex}}"></div></div><div class="col-md-10">{{tdd.text}} <i class="fa fa-calendar"></i></div></div>
                    </uib-tab-heading>
                    <div ng-if="filterOptions.selectedSection == null">
                        <uib-alert type="info"><b>Note:</b> You must select a section in order to view the dashboard.</uib-alert>
                    </div>
                </uib-tab>
            </uib-tabset>


            <!-- DIV Version -->
            <div ng-if="filterOptions.selectedSection != null">

                <div class="table-responsive">
                    <div class="container-fluid ns-table">
                        <div class="ns-table-row ns-table-header">
                            <div class="fixedCol1 ns-table-cell text-center">Edit</div>
                            <div class="fixedCol2 ns-table-cell text-center" ng-if="assessment.BaseType != 7">
                                Copy<br />TO<br />
                                <a href="" ng-click="openCopyDialog(null, true);" class="btn btn-success btn-xs"><i class="fa fa-copy"></i></a>
                            </div>
                            <div class="fixedCol2 ns-table-cell text-center" ng-if="assessment.BaseType != 7">
                                Copy<br />FROM<br />
                                <a href="" ng-click="openCopyFromDialog(null, true);" class="btn btn-orange btn-xs"><i class="fa fa-copy"></i></a>
                            </div>
                            <div class="fixedCol3 ns-table-cell text-center">Delete</div>
                            <div class="fixedCol4 ns-table-cell"><div style="cursor: pointer" ng-click="sort('StudentName')">Student Name <i class="{{staticColumnsObj.studentNameHeaderClass}}"></i></div></div>
                            <div class="ns-table-cell" ng-if="assessment.BaseType != 7">Recorder</div>
                            <div class="ns-table-cell" ng-if="assessment.BaseType != 7"><div style="cursor: pointer" ng-click="sort('TestDate')">Date Test Taken </div></div>
                            <div class="ns-table-cell text-center" ng-repeat="header in fields"><div style="cursor: pointer" ng-click="sort($index)">{{header.DisplayLabel}} <i class="{{headerClassArray[$index]}}"></i></div></div>

                        </div>
                        <form class="ns-table-row" ng-repeat="studentResult in studentResults | orderBy:sortArray" editable-form name="rowform" novalidate angular-validator onbeforesave="before(rowform);" angular-validator-submit="saveAssessmentData(studentResult)">

                            <div class="fixedCol1 ns-table-cell text-center" data-title="Edit">

                                <div ng-show="!rowform.$visible">
                                    <a class="btn btn-primary btn-xs" ng-click="defaultEditAction(studentResult, rowform)"><i class="fa fa-pencil"></i></a>
                                </div>
                                <div ng-show="rowform.$visible">
                                    <div class="extraHeader">Edit</div>
                                    <button type="submit" ng-disabled="rowform.$waiting" class="btn btn-sm btn-primary">
                                        <i class="fa fa-save"></i>
                                    </button>
                                    <button type="button" ng-disabled="rowform.$waiting" ng-click="rowform.$cancel()" class="btn btn-sm btn-default">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="fixedCol2 ns-table-cell text-center" data-title="Copy FROM" ng-if="assessment.BaseType != 7">
                                <div ng-show="rowform.$visible" class="extraHeader">Copy</div>
                                <a href="" ng-click="openCopyDialog(studentResult, false);" class="btn btn-success btn-xs"><i class="fa fa-copy"></i></a>
                            </div>
                            <div class="fixedCol2 ns-table-cell text-center" data-title="Copy TO" ng-if="assessment.BaseType != 7">
                                <div ng-show="rowform.$visible" class="extraHeader">Copy</div>
                                <a href="" ng-click="openCopyFromDialog(studentResult, false);" class="btn btn-orange btn-xs"><i class="fa fa-copy"></i></a>
                            </div>
                            <div class="fixedCol3 ns-table-cell text-center" data-title="Delete">
                                <div ng-show="rowform.$visible" class="extraHeader">Delete</div>
                                <a class="btn btn-danger btn-xs" ng-click="deleteAssessmentData(studentResult)"><i class="fa fa-trash-o"></i></a>
                            </div>
                            <div class="fixedCol4 ns-table-cell" data-title="FirstName"><div ng-show="rowform.$visible" class="extraHeader">Student Name</div><span ng-show="studentResult.IsCopied">*</span><span student-dashboard-link student-id="studentResult.StudentId" student-name="studentResult.StudentName"></span></div>
                            <div class="ns-table-cell" data-title="Recorder" ng-if="assessment.BaseType != 7">
                                <div ng-show="rowform.$visible">
                                    <div class="extraHeader">Recorder</div>
                                    <input name="primaryteacher" id="primaryteacher" validator="validateRecorder(studentResult)" ui-select2="getTeacherRemoteOptions" invalid-message="'Please select a Recorder'" required-message="'Please select a Recorder'" ng-model="studentResult.Recorder" required style="width: 120px" />
                                </div>
                                <div ng-show="!rowform.$visible">{{studentResult.Recorder.text}}</div>
                            </div>
                            <div class="ns-table-cell text-center" data-title="TestDate" ng-if="assessment.BaseType != 7">
                                <div ng-show="rowform.$visible" style="width:100px">
                                    <div class="extraHeader">Date Test Taken</div>
                                    <!--<input type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="studentResult.TestDate" is-open="popup1.opened" required invalid-message="Please enter a valid date" required-message="Please select a date" close-text="Close" />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button>
                            </span>-->
                                    <input style="cursor:pointer" type="text" name="pikaday" id="pikaday" class="form-control" picka-day ng-model="studentResult.TestDate" required invalid-message="Please enter a valid date" required-message="'Please select a date'" default-date="{{studentResult.TestDate}}" />
                                </div>
                                <div ng-show="!rowform.$visible">
                                    {{studentResult.TestDateDisplay}}
                                </div>
                            </div>
                            <div class="ns-table-cell text-center" ng-repeat="fieldResult in studentResult.FieldResults" data-title="{{::fieldResult.Field.DisplayLabel}}">
                                <div ng-show="rowform.$visible" class="extraHeader">{{::fieldResult.Field.DisplayLabel}}</div>
                                <ns-assessment-field mode="'grideditable'" e-form="rowform" result="fieldResult" field-required="fieldResult.Field.IsRequired" all-results="studentResult.FieldResults" ckeditor-options="ckeditorOptions"></ns-assessment-field>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <script type="text/ng-template" id="importBenchmarkData.html">
            <form novalidate angular-validator angular-validator-submit="upload(theFiles)" name="dataImportForm" role="form" enctype="multipart/form-data" class="form-horizontal">
                <div class="modal-header">
                    <h3 class="modal-title">Import Data To Test Date {{filterOptions.selectedBenchmarkDate.text}}</h3>
                </div>
                <div class="modal-body">
                    <fieldset>
                        <div class="form-group" ng-hide="uploadSettings.hasFiles">
                            <label for="fieldnick" class="col-md-3 control-label">Select File</label>
                            <div class="col-md-6">
                                <h3>Select .CSV file to import</h3>
                                <input type="file" id="newPhotos" class="uploadFile" accept="*.csv" eg-files="theFiles" has-files="uploadSettings.hasFiles">
                            </div>
                        </div>
                        <div class="form-group" ng-show="uploadSettings.hasFiles">
                            <label for="fieldabout" class="col-md-3 control-label">Upload File</label>
                            <div class="col-md-6">
                                <ul class="list-inline">
                                    <li><strong>file:</strong></li>
                                    <li ng-repeat="photo in theFiles"> {{photo.name}}</li>
                                </ul>

                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit" value="upload"><i class="fa fa-upload"></i> Upload</button>
                    <button class="btn btn-danger" id="formReset" type="reset" value="cancel" ng-click="cancel()"><i class="fa fa-times-circle"></i> Cancel</button>
                </div>
            </form>

        </script>
        <script type="text/ng-template" id="copyFieldTddChooser.html">
            <div class="modal-header">
                <h3 class="modal-title">Copy {{popupHeader()}} {{filterOptions.selectedBenchmarkDate.text}} Data <b>TO:</b> </h3>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="nsCenterAlignedText">
                                All TARGET Benchmark Dates
                            </th>
                            <th class="nsCenterAlignedText">
                                Select TARGET Benchmark Date
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="tdd in filterOptions.benchmarkDates">
                            <td class="nsCenterAlignedText">
                                <table style="margin:auto"><tr><td style="padding:5px;"><div style="border:1px solid black;width:20px;height:20px;background-color:{{tdd.Hex}}"></div></td><td>{{tdd.text}} <i class="fa fa-calendar"></i></td></tr></table>
                            </td>
                            <td class="nsCenterAlignedText">
                                <input ng-disabled="tdd.id == filterOptions.selectedBenchmarkDate.id" type="radio" icheck name="benchmarkDate" ng-value="tdd" ng-model="copySettings.targetCopyDate" />
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" ng-click="copyData()"><i class="fa fa-copy"></i> Copy</button> <button class="btn btn-default" ng-click="cancel()"><i class="fa fa-times-circle"></i> Cancel</button>
            </div>
        </script>
    <script type="text/ng-template" id="copyFromFieldTddChooser.html">
        <div class="modal-header">
            <h3 class="modal-title">Copying {{popupHeader()}} Data INTO Test Date {{filterOptions.selectedBenchmarkDate.text}} <b>FROM:</b></h3>
        </div>
        <div class="modal-body">
            <table class="table">
                <thead>
                    <tr>
                        <th class="nsCenterAlignedText">
                            All SOURCE Benchmark Dates
                        </th>
                        <th class="nsCenterAlignedText">
                            Select SOURCE Benchmark Date
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="tdd in filterOptions.multiYearBenchmarkDates">
                        <td class="nsCenterAlignedText">
                            <table style="margin:auto"><tr><td style="padding:5px;"><div style="border:1px solid black;width:20px;height:20px;background-color:{{tdd.Hex}}"></div></td><td>{{tdd.text}} <i class="fa fa-calendar"></i></td></tr></table>
                        </td>
                        <td class="nsCenterAlignedText">
                            <input ng-disabled="tdd.id == filterOptions.selectedBenchmarkDate.id" type="radio" icheck name="benchmarkDate" ng-value="tdd" ng-model="copySettings.sourceCopyDate" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-click="copyData()"><i class="fa fa-copy"></i> Copy</button> <button class="btn btn-default" ng-click="cancel()"><i class="fa fa-times-circle"></i> Cancel</button>
        </div>
    </script>

    </div>

<style>
        .has-feedback .form-control-feedback {
    top: 10px;
}
        .tab-container {
            margin-bottom: 4px;
        }
    /*.headerMinHeight{
        min-height:42px;
    }
    .cellMinHeight{
        min-height:25px;
    }
    .fixedCol1{
        position:absolute;
        width:38px;
        left:0;
        top:auto;
    }
        .fixedCol2{
        position:absolute;
        width:38px;
        left:38px;
        top:auto;
    }
            .fixedCol3{
        position:absolute;
        width:38px;
        left:76px;
        top:auto;
    }
                .fixedCol4{
        position:absolute;
        width:200px;
        left:114px;
        top:auto;
    }*/
     .table>tbody>tr>td
    {
         border: 1px solid #e9ecf0;
    }
         .table>thead>tr>th
    {
        border-top: 1px solid #e9ecf0 !important;
        border-left: 1px solid #e9ecf0;
        border-right: 1px solid #e9ecf0;
    }
         .table>thead>tr>th
         {
             padding: 5px 5px;
         }
        .table>tbody>tr>td
         {
             padding: 3px 5px;
         }
        .panel-body
        {
            overflow-x:auto;
        }
        select.editable-input{
            padding: 0px 0px !important;
        }
        select.form-control{
            padding: 0px 0px !important;
        }
        .extraHeader {
            font-weight: bold;
            color: #333333;
            margin-bottom: 15px;
            height: 55px;
        }

</style>

