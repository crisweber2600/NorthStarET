openapi: 3.0.3
info:
  title: NorthStar Configuration API
  description: |
    Configuration Service for NorthStar LMS.
    
    Provides:
    - District management and settings
    - School management
    - Academic calendar definitions
    - Grade level configurations
    - Multi-tenant organizational context
  version: 1.0.0
  contact:
    name: NorthStar Development Team
    email: dev@northstar.edu

servers:
  - url: https://api.northstar.edu/api/configuration
    description: Production API Gateway
  - url: http://localhost:5002/api
    description: Local Development

security:
  - BearerAuth: []

tags:
  - name: Districts
    description: School district management
  - name: Schools
    description: School management within districts
  - name: Calendars
    description: Academic calendar management
  - name: Grades
    description: Grade level definitions

paths:
  /districts:
    get:
      tags:
        - Districts
      summary: List districts
      description: Get all districts (system admin only) or current tenant district
      operationId: listDistricts
      responses:
        '200':
          description: Districts retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DistrictDto'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Districts
      summary: Create district
      description: Create new school district (system admin only)
      operationId: createDistrict
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDistrictRequest'
      responses:
        '201':
          description: District created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /districts/{districtId}:
    get:
      tags:
        - Districts
      summary: Get district by ID
      description: Retrieve district details
      operationId: getDistrictById
      parameters:
        - $ref: '#/components/parameters/DistrictId'
      responses:
        '200':
          description: District retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictDto'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Districts
      summary: Update district
      description: Update district information
      operationId: updateDistrict
      parameters:
        - $ref: '#/components/parameters/DistrictId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDistrictRequest'
      responses:
        '200':
          description: District updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /schools:
    get:
      tags:
        - Schools
      summary: List schools
      description: Get schools in current tenant district
      operationId: listSchools
      parameters:
        - name: isActive
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Schools retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchoolDto'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Schools
      summary: Create school
      description: Create new school in current district
      operationId: createSchool
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSchoolRequest'
      responses:
        '201':
          description: School created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchoolDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /schools/{schoolId}:
    get:
      tags:
        - Schools
      summary: Get school by ID
      description: Retrieve school details
      operationId: getSchoolById
      parameters:
        - $ref: '#/components/parameters/SchoolId'
      responses:
        '200':
          description: School retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchoolDto'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Schools
      summary: Update school
      description: Update school information
      operationId: updateSchool
      parameters:
        - $ref: '#/components/parameters/SchoolId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSchoolRequest'
      responses:
        '200':
          description: School updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchoolDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Schools
      summary: Delete school
      description: Soft delete school (sets IsActive=false)
      operationId: deleteSchool
      parameters:
        - $ref: '#/components/parameters/SchoolId'
      responses:
        '204':
          description: School deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /calendars:
    get:
      tags:
        - Calendars
      summary: List calendars
      description: Get calendars for district or specific school
      operationId: listCalendars
      parameters:
        - name: schoolId
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by school ID
        - name: schoolYear
          in: query
          schema:
            type: string
            pattern: '^\d{4}-\d{4}$'
          description: Filter by school year (e.g., "2024-2025")
      responses:
        '200':
          description: Calendars retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CalendarDto'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Calendars
      summary: Create calendar
      description: Create new academic calendar
      operationId: createCalendar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCalendarRequest'
      responses:
        '201':
          description: Calendar created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /calendars/{calendarId}:
    get:
      tags:
        - Calendars
      summary: Get calendar by ID
      description: Retrieve calendar details including all days
      operationId: getCalendarById
      parameters:
        - $ref: '#/components/parameters/CalendarId'
        - name: includeDays
          in: query
          schema:
            type: boolean
            default: true
          description: Include calendar days in response
      responses:
        '200':
          description: Calendar retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarDetailDto'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Calendars
      summary: Update calendar
      description: Update calendar information
      operationId: updateCalendar
      parameters:
        - $ref: '#/components/parameters/CalendarId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCalendarRequest'
      responses:
        '200':
          description: Calendar updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Calendars
      summary: Delete calendar
      description: Delete calendar and all associated days
      operationId: deleteCalendar
      parameters:
        - $ref: '#/components/parameters/CalendarId'
      responses:
        '204':
          description: Calendar deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /calendars/{calendarId}/days:
    post:
      tags:
        - Calendars
      summary: Add calendar day
      description: Add or update a specific day in calendar
      operationId: addCalendarDay
      parameters:
        - $ref: '#/components/parameters/CalendarId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalendarDayDto'
      responses:
        '201':
          description: Calendar day added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarDayDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /grades:
    get:
      tags:
        - Grades
      summary: List grade levels
      description: Get grade levels for current district
      operationId: listGradeLevels
      responses:
        '200':
          description: Grade levels retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GradeLevelDto'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Grades
      summary: Create grade level
      description: Add custom grade level to district
      operationId: createGradeLevel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGradeLevelRequest'
      responses:
        '201':
          description: Grade level created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GradeLevelDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Service health status
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: Service healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Service unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    DistrictId:
      name: districtId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    SchoolId:
      name: schoolId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    CalendarId:
      name: calendarId
      in: path
      required: true
      schema:
        type: string
        format: uuid

  schemas:
    DistrictDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        code:
          type: string
        state:
          type: string
          pattern: '^[A-Z]{2}$'
        timeZone:
          type: string
          example: America/Los_Angeles
        isActive:
          type: boolean
        contactEmail:
          type: string
          format: email
        contactPhone:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        schoolCount:
          type: integer
          description: Number of schools in district

    CreateDistrictRequest:
      type: object
      required:
        - name
        - code
        - state
        - timeZone
        - contactEmail
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 200
        code:
          type: string
          minLength: 2
          maxLength: 50
        state:
          type: string
          pattern: '^[A-Z]{2}$'
        timeZone:
          type: string
          example: America/Los_Angeles
        contactEmail:
          type: string
          format: email
        contactPhone:
          type: string

    UpdateDistrictRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 200
        timeZone:
          type: string
        isActive:
          type: boolean
        contactEmail:
          type: string
          format: email
        contactPhone:
          type: string

    SchoolDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        districtId:
          type: string
          format: uuid
        name:
          type: string
        code:
          type: string
        schoolType:
          type: string
          enum: [Elementary, Middle, High, K12, Charter]
        principalName:
          type: string
        principalEmail:
          type: string
          format: email
        address:
          $ref: '#/components/schemas/AddressDto'
        phoneNumber:
          type: string
        isActive:
          type: boolean
        enrollmentCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateSchoolRequest:
      type: object
      required:
        - name
        - code
        - schoolType
        - addressLine1
        - city
        - state
        - zipCode
        - phoneNumber
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 200
        code:
          type: string
          minLength: 2
          maxLength: 50
        schoolType:
          type: string
          enum: [Elementary, Middle, High, K12, Charter]
        principalName:
          type: string
        principalEmail:
          type: string
          format: email
        addressLine1:
          type: string
        addressLine2:
          type: string
        city:
          type: string
        state:
          type: string
          pattern: '^[A-Z]{2}$'
        zipCode:
          type: string
        phoneNumber:
          type: string

    UpdateSchoolRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 200
        schoolType:
          type: string
          enum: [Elementary, Middle, High, K12, Charter]
        principalName:
          type: string
        principalEmail:
          type: string
          format: email
        addressLine1:
          type: string
        addressLine2:
          type: string
        city:
          type: string
        state:
          type: string
          pattern: '^[A-Z]{2}$'
        zipCode:
          type: string
        phoneNumber:
          type: string
        isActive:
          type: boolean

    AddressDto:
      type: object
      properties:
        line1:
          type: string
        line2:
          type: string
        city:
          type: string
        state:
          type: string
        zipCode:
          type: string

    CalendarDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        districtId:
          type: string
          format: uuid
        schoolId:
          type: string
          format: uuid
          nullable: true
        schoolYear:
          type: string
          pattern: '^\d{4}-\d{4}$'
          example: "2024-2025"
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        totalInstructionalDays:
          type: integer
        name:
          type: string
        isDefault:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CalendarDetailDto:
      allOf:
        - $ref: '#/components/schemas/CalendarDto'
        - type: object
          properties:
            days:
              type: array
              items:
                $ref: '#/components/schemas/CalendarDayDto'

    CreateCalendarRequest:
      type: object
      required:
        - schoolYear
        - startDate
        - endDate
        - totalInstructionalDays
        - name
      properties:
        schoolId:
          type: string
          format: uuid
          nullable: true
          description: Null for district-wide calendar
        schoolYear:
          type: string
          pattern: '^\d{4}-\d{4}$'
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        totalInstructionalDays:
          type: integer
          minimum: 1
          maximum: 200
        name:
          type: string
        isDefault:
          type: boolean
          default: false

    UpdateCalendarRequest:
      type: object
      properties:
        name:
          type: string
        totalInstructionalDays:
          type: integer
          minimum: 1
          maximum: 200
        isDefault:
          type: boolean

    CalendarDayDto:
      type: object
      required:
        - date
        - dayType
      properties:
        id:
          type: string
          format: uuid
        date:
          type: string
          format: date
        dayType:
          type: string
          enum: [Instructional, Holiday, EarlyDismissal, ProfessionalDevelopment, WeatherClosure]
        description:
          type: string
          maxLength: 200
        isInstructional:
          type: boolean
          description: Computed based on dayType
        dismissalTime:
          type: string
          format: time
          example: "13:00:00"
          description: Required if dayType is EarlyDismissal

    GradeLevelDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "K"
        sequence:
          type: integer
          example: 1
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    CreateGradeLevelRequest:
      type: object
      required:
        - name
        - sequence
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 20
        sequence:
          type: integer

    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [Healthy, Degraded, Unhealthy]
        timestamp:
          type: string
          format: date-time
        checks:
          type: object
          additionalProperties:
            type: object
            properties:
              status:
                type: string
                enum: [Healthy, Degraded, Unhealthy]
              description:
                type: string
              duration:
                type: string

    ErrorResponse:
      type: object
      properties:
        type:
          type: string
        title:
          type: string
        status:
          type: integer
        traceId:
          type: string
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
